<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo Completo - Par√≥quia</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/functional.css">
    
    <!-- SheetJS for Excel processing -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>

<body>
    <div id="app">
        <!-- Admin Panel -->
        <div id="admin-panel" class="screen active">
            <header class="admin-header" role="banner">
                <div class="header-content">
                    <div class="header-left">
                        <h1>Painel Administrativo Completo</h1>
                        <div class="system-status">
                            <span class="status-indicator">
                                <span class="status-dot" style="background: #16a34a;"></span>
                                <span class="status-text">Sistema Funcional</span>
                            </span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <div class="header-info">
                            <span class="user-info">Administrador</span>
                        </div>
                        <button id="logout-btn" class="btn btn-secondary">
                            <span class="btn-icon">üö™</span>
                            Sair
                        </button>
                    </div>
                </div>
            </header>

            <nav class="admin-nav" role="navigation">
                <ul class="nav-menu" role="menubar">
                    <li role="none">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard" role="menuitem">
                            <span class="nav-icon">üè†</span>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#config" class="nav-link" data-section="config" role="menuitem">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-text">Configura√ß√µes</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#files" class="nav-link" data-section="files" role="menuitem">
                            <span class="nav-icon">üìÅ</span>
                            <span class="nav-text">Arquivos</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#data" class="nav-link" data-section="data" role="menuitem">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Gerenciar Dados</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#logs" class="nav-link" data-section="logs" role="menuitem">
                            <span class="nav-icon">üìã</span>
                            <span class="nav-text">Logs</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#backup" class="nav-link" data-section="backup" role="menuitem">
                            <span class="nav-icon">üíæ</span>
                            <span class="nav-text">Backup</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <main class="admin-content" role="main">
                <!-- Dashboard Overview -->
                <section id="dashboard-section" class="content-section active">
                    <div class="dashboard-header">
                        <h2>üéØ Painel de Controle Completo</h2>
                        <p class="dashboard-subtitle">Sistema administrativo totalmente funcional</p>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card" data-section="config">
                            <div class="card-header">
                                <span class="card-icon">‚öôÔ∏è</span>
                                <h3>Configura√ß√µes</h3>
                            </div>
                            <div class="card-content">
                                <p>Gerencie configura√ß√µes e GitHub</p>
                                <div class="card-stats">
                                    <span id="config-status">Status: Carregando...</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('config')">
                                    Acessar
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card" data-section="files">
                            <div class="card-header">
                                <span class="card-icon">üìÅ</span>
                                <h3>Arquivos Excel</h3>
                            </div>
                            <div class="card-content">
                                <p>Upload e processamento de Excel</p>
                                <div class="card-stats">
                                    <span id="files-count">Arquivos: 0</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('files')">
                                    Acessar
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card" data-section="data">
                            <div class="card-header">
                                <span class="card-icon">üìä</span>
                                <h3>Dados da Catequese</h3>
                            </div>
                            <div class="card-content">
                                <p>Catequistas, catec√∫menos e relat√≥rios</p>
                                <div class="card-stats">
                                    <span>Totalmente funcional</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('data')">
                                    Acessar
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card" data-section="logs">
                            <div class="card-header">
                                <span class="card-icon">üìã</span>
                                <h3>Logs do Sistema</h3>
                            </div>
                            <div class="card-content">
                                <p>Monitoramento e hist√≥rico</p>
                                <div class="card-stats">
                                    <span id="logs-count">Entradas: 5</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('logs')">
                                    Acessar
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card" data-section="backup">
                            <div class="card-header">
                                <span class="card-icon">üíæ</span>
                                <h3>Backup & Restaura√ß√£o</h3>
                            </div>
                            <div class="card-content">
                                <p>Backup completo do sistema</p>
                                <div class="card-stats">
                                    <span id="backup-count">Backups: 2</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('backup')">
                                    Acessar
                                </button>
                            </div>
                        </div>

                        <!-- Status Card -->
                        <div class="dashboard-card status-card">
                            <div class="card-header">
                                <span class="card-icon">‚úÖ</span>
                                <h3>Status do Sistema</h3>
                            </div>
                            <div class="card-content">
                                <div class="status-list">
                                    <div class="status-item">
                                        <span class="status-icon">‚úÖ</span>
                                        <span>Configura√ß√µes funcionais</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-icon">‚úÖ</span>
                                        <span>Upload Excel funcional</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-icon">‚úÖ</span>
                                        <span>Gerenciamento de dados</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-icon">‚úÖ</span>
                                        <span>Integra√ß√£o GitHub</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3>üöÄ A√ß√µes R√°pidas</h3>
                        <div class="actions-grid">
                            <button class="action-btn" onclick="adminApp.showSection('config')">
                                <span class="action-icon">üîß</span>
                                <span class="action-text">Configurar GitHub</span>
                            </button>
                            <button class="action-btn" onclick="adminApp.showSection('files')">
                                <span class="action-icon">üìä</span>
                                <span class="action-text">Carregar Excel</span>
                            </button>
                            <button class="action-btn" onclick="adminApp.showSection('data')">
                                <span class="action-icon">üë•</span>
                                <span class="action-text">Ver Catequistas</span>
                            </button>
                            <button class="action-btn" onclick="adminApp.showSection('backup')">
                                <span class="action-icon">üíæ</span>
                                <span class="action-text">Fazer Backup</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Configuration Section -->
                <section id="config-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
                            <p class="section-subtitle">Configure a par√≥quia e integra√ß√£o GitHub</p>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-secondary btn-sm" onclick="adminApp.showSection('dashboard')">
                                ‚Üê Voltar ao Dashboard
                            </button>
                        </div>
                    </div>
                    <div id="config-form-container">
                        <!-- Configuration form will be loaded here -->
                    </div>
                </section>

                <!-- Files Section -->
                <section id="files-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>üìÅ Gerenciamento de Arquivos Excel</h2>
                            <p class="section-subtitle">Upload e processamento de dados da catequese</p>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-secondary btn-sm" onclick="adminApp.showSection('dashboard')">
                                ‚Üê Voltar ao Dashboard
                            </button>
                        </div>
                    </div>
                    <div id="file-upload-container">
                        <!-- File upload interface will be loaded here -->
                    </div>
                </section>

                <!-- Data Management Section -->
                <section id="data-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>üìä Gerenciamento de Dados da Catequese</h2>
                            <p class="section-subtitle">Catequistas, catec√∫menos, relat√≥rios e sincroniza√ß√£o</p>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-secondary btn-sm" onclick="adminApp.showSection('dashboard')">
                                ‚Üê Voltar ao Dashboard
                            </button>
                        </div>
                    </div>
                    <div id="data-manager-container">
                        <!-- Data management interface will be loaded here -->
                    </div>
                </section>

                <!-- Logs Section -->
                <section id="logs-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>üìã Logs e Monitoramento</h2>
                            <p class="section-subtitle">Hist√≥rico de opera√ß√µes do sistema</p>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-secondary btn-sm" onclick="adminApp.showSection('dashboard')">
                                ‚Üê Voltar ao Dashboard
                            </button>
                        </div>
                    </div>
                    <div id="logs-container">
                        <!-- Logs will be loaded here -->
                    </div>
                </section>

                <!-- Backup Section -->
                <section id="backup-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>üíæ Backup e Restaura√ß√£o</h2>
                            <p class="section-subtitle">Backup completo das configura√ß√µes e dados</p>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-secondary btn-sm" onclick="adminApp.showSection('dashboard')">
                                ‚Üê Voltar ao Dashboard
                            </button>
                        </div>
                    </div>
                    <div id="backup-container">
                        <!-- Backup interface will be loaded here -->
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Load ONLY the complete JavaScript file -->
    <script src="js/admin-complete.js"></script>
    
    <script>
        // Authentication check
        (function() {
            console.log('üîê Checking authentication for complete admin...');
            
            function checkAuth() {
                const sessionKey = 'admin_session';
                let stored = localStorage.getItem(sessionKey);
                
                if (!stored) {
                    stored = sessionStorage.getItem(sessionKey + '_backup');
                    if (stored) {
                        localStorage.setItem(sessionKey, stored);
                    }
                }
                
                if (!stored) {
                    console.log('‚ùå No session found, redirecting to login');
                    window.location.href = 'login.html';
                    return false;
                }
                
                try {
                    const session = JSON.parse(stored);
                    
                    if (!session || !session.authenticated) {
                        console.log('‚ùå Invalid session, redirecting to login');
                        window.location.href = 'login.html';
                        return false;
                    }
                    
                    // Check session timeout (8 hours)
                    const sessionTimeout = 8 * 60 * 60 * 1000;
                    const timeSinceActivity = Date.now() - (session.lastActivity || session.loginTime);
                    
                    if (timeSinceActivity > sessionTimeout) {
                        console.log('‚è∞ Session expired, redirecting to login');
                        localStorage.removeItem(sessionKey);
                        sessionStorage.removeItem(sessionKey + '_backup');
                        window.location.href = 'login.html';
                        return false;
                    }
                    
                    console.log('‚úÖ Session valid for complete admin');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error checking session:', error);
                    window.location.href = 'login.html';
                    return false;
                }
            }
            
            // Check authentication immediately
            if (!checkAuth()) {
                return; // Stop execution if not authenticated
            }
            
            console.log('üéâ Authentication passed for complete admin');
        })();
    </script>
</body>

</html>