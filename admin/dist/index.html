<!DOCTYPE html> <html lang="pt-BR"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Painel Administrativo - ParÃ³quia</title> <link rel="stylesheet" href="styles/main.css"> <link rel="stylesheet" href="styles/responsive.css"> </head> <body> <div id="app"> <a href="#main-content" class="skip-link">Pular para o conteÃºdo principal</a> <a href="#navigation" class="skip-link">Pular para a navegaÃ§Ã£o</a> <div id="admin-panel" class="screen active"> <header class="admin-header" role="banner"> <div class="header-content"> <div class="header-left"> <h1>Painel Administrativo</h1> <div class="system-status"> <span id="connection-status" class="status-indicator" title="Status da conexÃ£o"> <span class="status-dot"></span> <span class="status-text">Conectado</span> </span> <span id="github-status" class="status-indicator" title="Status do GitHub"> <span class="status-dot"></span> <span class="status-text">GitHub OK</span> </span> </div> </div> <div class="header-actions"> <div class="header-info"> <span id="last-sync" class="sync-info" title="Ãšltima sincronizaÃ§Ã£o"> Ãšltima sync: -- </span> <span id="user-info" class="user-info">Administrador</span> </div> <button id="system-diagnostics-btn" class="btn btn-icon" title="DiagnÃ³sticos do Sistema"> <span class="btn-icon">ğŸ”</span> </button> <button id="integration-test-btn" class="btn btn-icon" title="Teste de IntegraÃ§Ã£o"> <span class="btn-icon">ğŸ§ª</span> </button> <button id="emergency-reset-btn" class="btn btn-icon btn-danger" title="Reset de EmergÃªncia"> <span class="btn-icon">ğŸš¨</span> </button> <button id="logout-btn" class="btn btn-secondary"> <span class="btn-icon">ğŸšª</span> Sair </button> </div> </div> </header> <nav class="admin-nav" role="navigation" id="navigation" aria-label="NavegaÃ§Ã£o principal"> <ul class="nav-menu" role="menubar"> <li role="none"> <a href="#config" class="nav-link active" data-section="config" role="menuitem" aria-current="page"> <span class="nav-icon" aria-hidden="true">âš™ï¸</span> <span class="nav-text">ConfiguraÃ§Ãµes</span> <span class="nav-badge" id="config-badge" aria-label="NotificaÃ§Ãµes de configuraÃ§Ã£o"></span> </a> </li> <li role="none"> <a href="#files" class="nav-link" data-section="files" role="menuitem"> <span class="nav-icon" aria-hidden="true">ğŸ“</span> <span class="nav-text">Arquivos</span> <span class="nav-badge" id="files-badge" aria-label="NotificaÃ§Ãµes de arquivos"></span> </a> </li> <li role="none"> <a href="#data" class="nav-link" data-section="data" role="menuitem"> <span class="nav-icon" aria-hidden="true">ğŸ“Š</span> <span class="nav-text">Gerenciar Dados</span> <span class="nav-badge" id="data-badge" aria-label="NotificaÃ§Ãµes de dados"></span> </a> </li> <li role="none"> <a href="#logs" class="nav-link" data-section="logs" role="menuitem"> <span class="nav-icon" aria-hidden="true">ğŸ“‹</span> <span class="nav-text">Logs</span> <span class="nav-badge" id="logs-badge" aria-label="NotificaÃ§Ãµes de logs"></span> </a> </li> <li role="none"> <a href="#backup" class="nav-link" data-section="backup" role="menuitem"> <span class="nav-icon" aria-hidden="true">ğŸ’¾</span> <span class="nav-text">Backup</span> <span class="nav-badge" id="backup-badge" aria-label="NotificaÃ§Ãµes de backup"></span> </a> </li> </ul> <div class="nav-actions"> <button id="refresh-all" class="btn btn-icon" title="Atualizar todos os dados"> <span class="btn-icon">ğŸ”„</span> </button> <button id="toggle-notifications" class="btn btn-icon" title="Alternar notificaÃ§Ãµes"> <span class="btn-icon">ğŸ””</span> </button> </div> </nav> <main class="admin-content" role="main" id="main-content"> <section id="dashboard-section" class="content-section"> <div class="dashboard-header"> <h2>Painel de Controle</h2> <p class="dashboard-subtitle">VisÃ£o geral do sistema administrativo</p> </div> <div class="dashboard-grid"> <div class="dashboard-card" data-section="config"> <div class="card-header"> <span class="card-icon">âš™ï¸</span> <h3>ConfiguraÃ§Ãµes</h3> </div> <div class="card-content"> <p>Gerencie as configuraÃ§Ãµes da parÃ³quia</p> <div class="card-stats"> <span id="config-status" class="stat-item">Status: OK</span> </div> </div> <div class="card-actions"> <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('config')"> Acessar </button> </div> </div> <div class="dashboard-card" data-section="files"> <div class="card-header"> <span class="card-icon">ğŸ“</span> <h3>Arquivos</h3> </div> <div class="card-content"> <p>Upload e gerenciamento de arquivos</p> <div class="card-stats"> <span id="files-count" class="stat-item">Arquivos: --</span> </div> </div> <div class="card-actions"> <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('files')"> Acessar </button> </div> </div> <div class="dashboard-card" data-section="logs"> <div class="card-header"> <span class="card-icon">ğŸ“‹</span> <h3>Logs</h3> </div> <div class="card-content"> <p>Visualize logs e histÃ³rico do sistema</p> <div class="card-stats"> <span id="logs-count" class="stat-item">Entradas: --</span> </div> </div> <div class="card-actions"> <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('logs')"> Acessar </button> </div> </div> <div class="dashboard-card" data-section="backup"> <div class="card-header"> <span class="card-icon">ğŸ’¾</span> <h3>Backup</h3> </div> <div class="card-content"> <p>Backup e restauraÃ§Ã£o de dados</p> <div class="card-stats"> <span id="backup-count" class="stat-item">Backups: --</span> </div> </div> <div class="card-actions"> <button class="btn btn-primary btn-sm" onclick="adminApp.showSection('backup')"> Acessar </button> </div> </div> <div class="dashboard-card" data-section="system-health"> <div class="card-header"> <span class="card-icon">ğŸ”</span> <h3>Sistema</h3> </div> <div class="card-content"> <p>Monitoramento e diagnÃ³sticos</p> <div class="card-stats"> <span id="error-rate" class="stat-item">Taxa de erro: --</span> <span id="system-status" class="stat-item">Status: --</span> </div> </div> <div class="card-actions"> <button class="btn btn-primary btn-sm" onclick="adminApp.handleSystemDiagnostics()"> DiagnÃ³sticos </button> </div> </div> </div> <div class="recent-activity"> <h3>Atividade Recente</h3> <div id="recent-logs" class="activity-list"> </div> </div> </section> <section id="config-section" class="content-section"> <div class="section-header"> <div class="section-title"> <h2>ConfiguraÃ§Ãµes da ParÃ³quia</h2> <p class="section-subtitle">Gerencie as configuraÃ§Ãµes do sistema</p> </div> <div class="section-actions"> <button id="back-to-dashboard" class="btn btn-secondary btn-sm"> â† Voltar ao Dashboard </button> </div> </div> <div class="config-card" style="margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #e2e8f0; border-radius: 8px; background: #f8f9fa;"> <h3 style="margin: 0 0 1rem 0; color: #2d3748;">ğŸ”‘ ConfiguraÃ§Ã£o GitHub</h3> <p style="margin: 0 0 1rem 0; color: #718096;">Configure seu Personal Access Token para sincronizaÃ§Ã£o com o repositÃ³rio.</p> <div style="display: flex; gap: 1rem; align-items: end; flex-wrap: wrap;"> <div style="flex: 1; min-width: 300px;"> <label for="github-token" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">GitHub Token:</label> <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace;"> </div> <button id="save-github-token" class="btn btn-primary" onclick="adminApp.saveGitHubToken()"> ğŸ’¾ Salvar Token </button> </div> <div id="github-status" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"> </div> <details style="margin-top: 1rem;"> <summary style="cursor: pointer; font-weight: 600; color: #4a5568;">Como criar um Personal Access Token?</summary> <div style="margin-top: 0.5rem; padding: 1rem; background: white; border-radius: 6px; font-size: 0.9rem;"> <ol style="margin: 0; padding-left: 1.5rem;"> <li>VÃ¡ para <strong>GitHub.com â†’ Settings â†’ Developer settings â†’ Personal access tokens</strong></li> <li>Clique em <strong>"Generate new token (classic)"</strong></li> <li>Configure os scopes: <code>repo</code>, <code>workflow</code>, <code>write:packages</code> (opcional) </li> <li>Copie o token e cole no campo acima</li> </ol> </div> </details> </div> <div id="config-form-container"> <div id="debug-panel" style="margin: 20px; padding: 20px; border: 2px solid #ccc; background: #f9f9f9;"> <h4>Debug Panel</h4> <button onclick="window.debugTest()" style="padding: 10px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px;"> Testar Carregamento de ConfiguraÃ§Ã£o </button> <button onclick="window.debugFileUpload()" style="padding: 10px; margin: 5px; background: #28a745; color: white; border: none; border-radius: 4px;"> Testar Upload de Arquivos </button> <button onclick="window.debugAuth()" style="padding: 10px; margin: 5px; background: #17a2b8; color: white; border: none; border-radius: 4px;"> Testar AutenticaÃ§Ã£o </button> <button onclick="window.forceLogin()" style="padding: 10px; margin: 5px; background: #ffc107; color: black; border: none; border-radius: 4px;"> ForÃ§ar Login </button> <button onclick="window.forceLogout()" style="padding: 10px; margin: 5px; background: #dc3545; color: white; border: none; border-radius: 4px;"> ForÃ§ar Logout </button> <div id="debug-output" style="margin-top: 10px; padding: 10px; background: white; border: 1px solid #ddd; font-family: monospace; white-space: pre-wrap;"></div> </div> </div> </section> <section id="files-section" class="content-section"> <div class="section-header"> <div class="section-title"> <h2>Gerenciamento de Arquivos</h2> <p class="section-subtitle">Upload e gerenciamento de arquivos do sistema</p> </div> <div class="section-actions"> <button id="back-to-dashboard-files" class="btn btn-secondary btn-sm"> â† Voltar ao Dashboard </button> </div> </div> <div id="file-upload-container"> </div> </section> <section id="data-section" class="content-section"> <div class="section-header"> <div class="section-title"> <h2>Gerenciamento de Dados</h2> <p class="section-subtitle">Gerencie catequistas, catecÃºmenos e dados do Excel</p> </div> <div class="section-actions"> <button id="back-to-dashboard-data" class="btn btn-secondary btn-sm"> â† Voltar ao Dashboard </button> </div> </div> <div id="data-manager-container"> </div> </section> <section id="logs-section" class="content-section"> <div class="section-header"> <div class="section-title"> <h2>Logs do Sistema</h2> <p class="section-subtitle">Visualize o histÃ³rico de operaÃ§Ãµes</p> </div> <div class="section-actions"> <button id="back-to-dashboard-logs" class="btn btn-secondary btn-sm"> â† Voltar ao Dashboard </button> </div> </div> <div id="logs-container"> </div> </section> <section id="backup-section" class="content-section"> <div class="section-header"> <div class="section-title"> <h2>Backup e RestauraÃ§Ã£o</h2> <p class="section-subtitle">Gerencie backups das configuraÃ§Ãµes</p> </div> <div class="section-actions"> <button id="back-to-dashboard-backup" class="btn btn-secondary btn-sm"> â† Voltar ao Dashboard </button> </div> </div> <div id="backup-container"> </div> </section> </main> <div id="progress-overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="progress-title"> <div class="progress-container"> <h3 id="progress-title">Processando...</h3> <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"> <div id="progress-fill" class="progress-fill"></div> </div> <p id="progress-message" aria-live="polite">Iniciando operaÃ§Ã£o...</p> <button id="cancel-operation" class="btn btn-secondary">Cancelar</button> </div> </div> <div id="notification-container" class="notification-container" role="region" aria-label="NotificaÃ§Ãµes" aria-live="polite"></div> </div> </div> <script src="js/interfaces/types.js"></script> <script src="js/utils/SessionValidator.js"></script> <script src="js/utils/LogThrottler.js"></script> <script src="js/utils/ResponseHandler.js"></script> <script src="js/utils/FileOptimizer.js"></script> <script src="js/utils/GitHubOptimizer.js"></script> <script src="js/utils/DeploymentVerifier.js"></script> <script src="js/utils/SystemRecovery.js"></script> <script src="js/utils/ErrorReporter.js"></script> <script src="js/managers/DeploymentManager.js"></script> <script src="js/managers/TokenManager.js"></script> <script src="js/managers/SecurityManager.js"></script> <script src="js/managers/AuthManager.js"></script> <script src="js/managers/ConfigManager.js"></script> <script src="js/managers/FileManager.js"></script> <script src="js/managers/GitHubManager.js"></script> <script src="js/managers/ProgressTracker.js"></script> <script src="js/managers/LogManager.js"></script> <script src="js/utils/validation.js"></script> <script src="js/utils/helpers.js"></script> <script src="js/utils/CustomErrors.js"></script> <script src="js/utils/ErrorHandler.js"></script> <script src="js/utils/NotificationManager.js"></script> <script src="js/utils/DialogManager.js"></script> <script src="js/utils/ErrorWrapper.js"></script> <script src="js/components/ProgressBar.js"></script> <script src="js/components/ConfigForm.js"></script> <script src="js/components/BackupManager.js"></script> <script src="js/components/FileUpload.js"></script> <script src="js/components/DataManager.js"></script> <script src="js/components/LogDisplay.js"></script> <script src="js/app_simple.js"></script> <script> // Force authentication check before loading app (function() { console.log('Checking authentication before app load...'); function checkAuth() { const sessionKey = 'admin_session'; let stored = localStorage.getItem(sessionKey); if (!stored) { stored = sessionStorage.getItem(sessionKey + '_backup'); if (stored) { localStorage.setItem(sessionKey, stored); } } if (!stored) { console.log('No session found, redirecting to login'); window.location.href = 'login.html'; return false; } try { const session = JSON.parse(stored); if (!session || !session.authenticated) { console.log('Invalid session, redirecting to login'); window.location.href = 'login.html'; return false; } // Check session timeout (8 hours) const sessionTimeout = 8 * 60 * 60 * 1000; const timeSinceActivity = Date.now() - (session.lastActivity || session.loginTime); if (timeSinceActivity > sessionTimeout) { console.log('Session expired, redirecting to login'); localStorage.removeItem(sessionKey); sessionStorage.removeItem(sessionKey + '_backup'); window.location.href = 'login.html'; return false; } console.log('Session valid, continuing to app'); return true; } catch (error) { console.error('Error checking session:', error); window.location.href = 'login.html'; return false; } } // Check authentication immediately if (!checkAuth()) { return; // Stop execution if not authenticated } // If authenticated, continue with app initialization console.log('Authentication check passed, initializing app...'); })(); </script> </body> </html>